import{_ as t,r as c,o as p,a as r,d as s,b as a,w as e,F as i,e as o,f as l}from"./app.7eb989d9.js";const u={},b=s("div",{class:"custom-container info"},[s("p",{class:"custom-container-title"},"\u76F8\u5173\u4FE1\u606F"),s("p",null,"\u2003\u2003ElasticSearch\u901A\u8FC7\u96C6\u7FA4\u67B6\u6784\u662F\u751F\u4EA7\u73AF\u5883\u4E2D\u5E38\u7528\u7684\uFF0C\u53EF\u4EE5\u5B9E\u73B0\u9AD8\u53EF\u7528\u548C\u9AD8\u6269\u5C55\u7684\u624B\u6BB5\u3002\u5176\u9AD8\u53EF\u7528\u4F53\u73B0\u5728\u4E24\u70B9\uFF1A\u670D\u52A1\u53EF\u7528\u6027\uFF0C\u5373\u5141\u8BB8\u8282\u70B9\u505C\u6B62\u670D\u52A1\uFF1B\u6570\u636E\u53EF\u7528\u6027\uFF0C\u5373\u90E8\u5206\u8282\u70B9\u4E22\u5931\uFF0C\u4E0D\u4F1A\u4E22\u5931\u6570\u636E\u3002\u5176\u53EF\u6269\u5C55\u6027\u4F53\u73B0\u5728\u53EF\u4EE5\u5C06\u5B58\u50A8\u6C34\u5E73\u6269\u5BB9\u3002")],-1),m={class:"table-of-contents"},d=l("\u8282\u70B9\u89D2\u8272"),h=l("\u5355\u89D2\u8272\u90E8\u7F72"),k=l("\u6C34\u5E73\u6269\u5C55\u573A\u666F"),_=l("\u8BFB\u5199\u5206\u79BB\u573A\u666F"),g=l("\u5F02\u5730\u591A\u6D3B\u67B6\u6784"),f=l("Hot & Warm\u67B6\u6784"),y=l("\u96C6\u7FA4\u5BB9\u91CF\u89C4\u5212\u601D\u8DEF"),v=l("\u4E1A\u52A1\u8BC4\u4F30\u548C\u5E94\u7528\u573A\u666F\u8BC4\u4F30"),x=l("\u786C\u4EF6\u548C\u5BB9\u91CF\u8BC4\u4F30"),w=l("\u90E8\u7F72\u65B9\u5F0F\u548C\u6269\u5BB9\u65B9\u5F0F\u8BC4\u4F30"),E=l("\u96C6\u7FA4\u89C4\u5212\u5178\u578B\u6848\u4F8B"),q=l("\u5927\u6570\u636E\u96C6\u4F4E\u5199\u5165\u4E1A\u52A1\u89C4\u5212"),S=l("\u65F6\u95F4\u5E8F\u5217\u6570\u636E\u89C4\u5212"),C=l("\u9644\u5F55\uFF1A\u7279\u6027\u3001\u90E8\u7F72\u3001\u914D\u7F6E"),A=l("\u7248\u672C\u7279\u6027"),L=l("\u6587\u4EF6\u7ED3\u6784"),V=l("\u914D\u7F6E\u6587\u4EF6"),N=l("\u96C6\u7FA4\u5B89\u5168"),O=l("\u96C6\u7FA4\u542F\u52A8"),P=o(`<hr><h2 id="\u8282\u70B9\u89D2\u8272" tabindex="-1"><a class="header-anchor" href="#\u8282\u70B9\u89D2\u8272" aria-hidden="true">#</a> \u8282\u70B9\u89D2\u8272</h2><h2 id="\u5355\u89D2\u8272\u90E8\u7F72" tabindex="-1"><a class="header-anchor" href="#\u5355\u89D2\u8272\u90E8\u7F72" aria-hidden="true">#</a> \u5355\u89D2\u8272\u90E8\u7F72</h2><h2 id="\u6C34\u5E73\u6269\u5C55\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#\u6C34\u5E73\u6269\u5C55\u573A\u666F" aria-hidden="true">#</a> \u6C34\u5E73\u6269\u5C55\u573A\u666F</h2><h2 id="\u8BFB\u5199\u5206\u79BB\u573A\u666F" tabindex="-1"><a class="header-anchor" href="#\u8BFB\u5199\u5206\u79BB\u573A\u666F" aria-hidden="true">#</a> \u8BFB\u5199\u5206\u79BB\u573A\u666F</h2><h2 id="\u5F02\u5730\u591A\u6D3B\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#\u5F02\u5730\u591A\u6D3B\u67B6\u6784" aria-hidden="true">#</a> \u5F02\u5730\u591A\u6D3B\u67B6\u6784</h2><h2 id="hot-warm\u67B6\u6784" tabindex="-1"><a class="header-anchor" href="#hot-warm\u67B6\u6784" aria-hidden="true">#</a> Hot &amp; Warm\u67B6\u6784</h2><h2 id="\u96C6\u7FA4\u5BB9\u91CF\u89C4\u5212\u601D\u8DEF" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u5BB9\u91CF\u89C4\u5212\u601D\u8DEF" aria-hidden="true">#</a> \u96C6\u7FA4\u5BB9\u91CF\u89C4\u5212\u601D\u8DEF</h2><h3 id="\u4E1A\u52A1\u8BC4\u4F30\u548C\u5E94\u7528\u573A\u666F\u8BC4\u4F30" tabindex="-1"><a class="header-anchor" href="#\u4E1A\u52A1\u8BC4\u4F30\u548C\u5E94\u7528\u573A\u666F\u8BC4\u4F30" aria-hidden="true">#</a> \u4E1A\u52A1\u8BC4\u4F30\u548C\u5E94\u7528\u573A\u666F\u8BC4\u4F30</h3><h3 id="\u786C\u4EF6\u548C\u5BB9\u91CF\u8BC4\u4F30" tabindex="-1"><a class="header-anchor" href="#\u786C\u4EF6\u548C\u5BB9\u91CF\u8BC4\u4F30" aria-hidden="true">#</a> \u786C\u4EF6\u548C\u5BB9\u91CF\u8BC4\u4F30</h3><h3 id="\u90E8\u7F72\u65B9\u5F0F\u548C\u6269\u5BB9\u65B9\u5F0F\u8BC4\u4F30" tabindex="-1"><a class="header-anchor" href="#\u90E8\u7F72\u65B9\u5F0F\u548C\u6269\u5BB9\u65B9\u5F0F\u8BC4\u4F30" aria-hidden="true">#</a> \u90E8\u7F72\u65B9\u5F0F\u548C\u6269\u5BB9\u65B9\u5F0F\u8BC4\u4F30</h3><h2 id="\u96C6\u7FA4\u89C4\u5212\u5178\u578B\u6848\u4F8B" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u89C4\u5212\u5178\u578B\u6848\u4F8B" aria-hidden="true">#</a> \u96C6\u7FA4\u89C4\u5212\u5178\u578B\u6848\u4F8B</h2><h3 id="\u5927\u6570\u636E\u96C6\u4F4E\u5199\u5165\u4E1A\u52A1\u89C4\u5212" tabindex="-1"><a class="header-anchor" href="#\u5927\u6570\u636E\u96C6\u4F4E\u5199\u5165\u4E1A\u52A1\u89C4\u5212" aria-hidden="true">#</a> \u5927\u6570\u636E\u96C6\u4F4E\u5199\u5165\u4E1A\u52A1\u89C4\u5212</h3><h3 id="\u65F6\u95F4\u5E8F\u5217\u6570\u636E\u89C4\u5212" tabindex="-1"><a class="header-anchor" href="#\u65F6\u95F4\u5E8F\u5217\u6570\u636E\u89C4\u5212" aria-hidden="true">#</a> \u65F6\u95F4\u5E8F\u5217\u6570\u636E\u89C4\u5212</h3><h2 id="\u9644\u5F55-\u7279\u6027\u3001\u90E8\u7F72\u3001\u914D\u7F6E" tabindex="-1"><a class="header-anchor" href="#\u9644\u5F55-\u7279\u6027\u3001\u90E8\u7F72\u3001\u914D\u7F6E" aria-hidden="true">#</a> \u9644\u5F55\uFF1A\u7279\u6027\u3001\u90E8\u7F72\u3001\u914D\u7F6E</h2><h3 id="\u7248\u672C\u7279\u6027" tabindex="-1"><a class="header-anchor" href="#\u7248\u672C\u7279\u6027" aria-hidden="true">#</a> \u7248\u672C\u7279\u6027</h3><p>Elasticsearch7.x\u7279\u6027\uFF1A</p><ul><li>Lucence 8.0</li><li>\u5E9F\u9664\u5355\u4E2A\u7D22\u5F15\u4E0B\u591A\u4E2Atype</li><li>security\u514D\u8D39</li><li>ECK\uFF1AElasticsearch Operator on Kubernetes</li><li>\u65B0\u7279\u6027 <ul><li>New Cluster coordination</li><li>Complete High Level REST Client</li><li>Script Score Query</li></ul></li><li>\u9ED8\u8BA4\u7684Primary Shard\u6570\u4ECE5\u6539\u4E3A1,\u907F\u514DOver Sharding</li><li>\u66F4\u5FEB\u7684Top K</li><li>\u5185\u7F6E java \u73AF\u5883</li></ul><p>Elasticsearch8.x\u7279\u6027\uFF1A</p><ul><li>RestAPI \u6539\u52A8\u5F88\u5927\uFF0C\u5982\u5220\u9664_type</li><li>\u9ED8\u8BA4\u5F00\u542F\u5B89\u5168\u914D\u7F6E</li><li>\u5B58\u50A8\u7A7A\u95F4\u4F18\u5316\uFF1A\u5012\u6392\u7D22\u5F15\u4F7F\u7528\u65B0\u7F16\u7801\u96C6\uFF0C\u5BF9\u4E8Ekeyword\u3001match_only_text\u3001text\u7C7B\u578B\u5B57\u6BB5\u6709\u6548\uFF0C\u67093.5%\u7684\u7A7A\u95F4\u4F18\u5316\u63D0\u5347\uFF0C\u5BF9\u4E8E\u65B0\u5EFA\u7D22\u5F15\u548Csegment\u81EA\u52A8\u751F\u6548\u3002</li><li>\u4F18\u5316geo_point\uFF0Cgeo_shape\u7C7B\u578B\u7684\u7D22\u5F15\uFF08\u5199\u5165\uFF09\u6548\u7387\uFF1A15%\u7684\u63D0\u5347\u3002</li></ul><h3 id="\u6587\u4EF6\u7ED3\u6784" tabindex="-1"><a class="header-anchor" href="#\u6587\u4EF6\u7ED3\u6784" aria-hidden="true">#</a> \u6587\u4EF6\u7ED3\u6784</h3><div class="language-lua ext-lua line-numbers-mode"><pre class="language-lua"><code>elasticsearch
\u2502  \u251C\u2500bin <span class="token comment">-- \u811A\u672C\u6587\u4EF6\uFF0C\u5305\u62EC\u542F\u52A8elasticsearch\uFF0C\u5B89\u88C5\u63D2\u4EF6\uFF0C\u8FD0\u884C\u7EDF\u8BA1\u6570\u636E\u7B49</span>
\u2502  \u251C\u2500config <span class="token comment">-- \u914D\u7F6E\u6587\u4EF6\u76EE\u5F55\uFF0C\u5982elasticsearch\u914D\u7F6E\u3001\u89D2\u8272\u914D\u7F6E\u3001jvm\u914D\u7F6E\u7B49</span>
\u2502  \u251C\u2500jdk <span class="token comment">-- java\u8FD0\u884C\u73AF\u5883</span>
\u2502  \u251C\u2500data <span class="token comment">-- \u9ED8\u8BA4\u7684\u6570\u636E\u5B58\u653E\u76EE\u5F55\uFF0C\u5305\u542B\u8282\u70B9\u3001\u5206\u7247\u3001\u7D22\u5F15\u3001\u6587\u6863\u7684\u6240\u6709\u6570\u636E\uFF0C\u751F\u4EA7\u73AF\u5883\u9700\u8981\u4FEE\u6539</span>
\u2502  \u251C\u2500lib <span class="token comment">-- elasticsearch\u4F9D\u8D56\u7684Java\u7C7B\u5E93</span>
\u2502  \u251C\u2500logs <span class="token comment">-- \u9ED8\u8BA4\u7684\u65E5\u5FD7\u6587\u4EF6\u5B58\u50A8\u8DEF\u5F84\uFF0C\u751F\u4EA7\u73AF\u5883\u9700\u8981\u4FEE\u6539</span>
\u2502  \u251C\u2500modules <span class="token comment">-- \u5305\u542B\u6240\u6709\u7684Elasticsearch\u6A21\u5757\uFF0C\u5982Cluster\u3001Discovery\u3001Indices\u7B49</span>
\u2502  \u251C\u2500plugins <span class="token comment">-- \u5DF2\u5B89\u88C5\u63D2\u4EF6\u76EE\u5F55</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><h3 id="\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6</h3><p>\u2003\u2003Elasticsearch\u662F\u57FA\u4E8E\u5185\u5B58\u7684\u6570\u636E\u5B58\u50A8\u670D\u52A1\uFF0CJVM\u7684\u73AF\u5883\u914D\u7F6E\u4F18\u5148\u7EA7\u4E3AES_JAVA_HOME&gt;JAVA_HOME&gt;ES_HOME\uFF0C\u5176\u4E2D\u6570\u636E\u8282\u70B9\u975E\u5E38\u6D88\u8017\u5185\u5B58\uFF0C\u56E0\u6B64\u9700\u8981\u914D\u7F6EJVM\u7684\u5806\u5185\u5B58\uFF0C\u8FDB\u5165elasticsearch\u7684config\u76EE\u5F55\u4E0B\uFF0C\u4FEE\u6539jvm\u914D\u7F6E(4G\u4EE5\u4E0A30G\u4EE5\u4E0B https://www.elastic.co/cn/blog/a-heap-of-trouble)\uFF1A</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">vim</span> jvm.options
-Xms4g
-Xmx4g
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u2003\u2003Elasticsearch\u542F\u52A8\u4E0D\u5141\u8BB8\u4F7F\u7528root\u8D26\u6237\uFF0C\u9700\u8981\u4E3AElasticsearch\u521B\u5EFA\u8FD0\u884C\u8D26\u53F7\uFF0C\u5E76\u8D4B\u4E88\u76EE\u5F55\u76F8\u5173\u6743\u9650\u3002</p><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>adduser es
<span class="token function">passwd</span> es 
<span class="token function">chown</span> -R es:es /opt/elasticsearch/elasticsearch-8.3.2
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>\u2003\u2003\u4FEE\u6539Elasticsearch\u914D\u7F6E\u6587\u4EF6\uFF0C\u5177\u4F53\u914D\u7F6E\u9879\u53CA\u5176\u610F\u4E49\u5982\u4E0B\u6240\u793A\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">cluster.name</span><span class="token punctuation">:</span> \u96C6\u7FA4\u540D\u79F0
<span class="token key atrule">node.name</span><span class="token punctuation">:</span> \u8282\u70B9\u7684\u540D\u79F0
<span class="token key atrule">node.roles</span><span class="token punctuation">:</span> <span class="token punctuation">[</span> data<span class="token punctuation">,</span> master<span class="token punctuation">]</span>
<span class="token key atrule">bootstrap.memory_lock</span><span class="token punctuation">:</span> <span class="token boolean important">true</span> <span class="token comment">#\u662F\u5426\u5F00\u542F\u65F6\u9501\u5B9A\u5185\u5B58\uFF08\u9ED8\u8BA4\u4E3A\u662F\uFF09</span>
<span class="token comment"># \u6CE8\u610F\u8FD9\u4E24\u4E2A\u8DEF\u5F84\u4E0D\u8981\u914D\u7F6E\u7269\u7406\u673A\u7684\u8DEF\u5F84\u4E86\uFF0C\u8FD9\u662F\u3010\u5BB9\u5668\u5185\u90E8\u3011\u7684\u8DEF\u5F84\uFF01\uFF01</span>
<span class="token key atrule">path.data</span><span class="token punctuation">:</span> /usr/share/elasticsearch/data <span class="token comment"># \u6570\u636E\u5B58\u6863\u4F4D\u7F6E</span>
<span class="token key atrule">path.logs</span><span class="token punctuation">:</span> /usr/share/elasticsearch/log   <span class="token comment"># \u65E5\u5FD7\u5B58\u653E\u4F4D\u7F6E</span>
<span class="token comment"># \u914D\u5408network.publish_host \u4E00\u8D77\u4F7F\u7528\u3002\u53C2\u89C1\u4E0B\u6587\u7684\u5C0F\u7A8D\u95E8\uFF1A</span>
<span class="token key atrule">network.host</span><span class="token punctuation">:</span> 10.10.10.11 <span class="token comment">#\u8BBE\u7F6E\u7F51\u5173\u5730\u5740</span>
<span class="token comment"># \u8BBE\u7F6E\u5176\u5B83\u7ED3\u70B9\u548C\u8BE5\u7ED3\u70B9\u4EA4\u4E92\u7684ip\u5730\u5740\uFF0C\u5982\u679C\u4E0D\u8BBE\u7F6E\u5B83\u4F1A\u81EA\u52A8\u5224\u65AD\uFF0C\u503C\u5FC5\u987B\u662F\u4E2A\u771F\u5B9E\u7684ip\u5730\u5740\uFF0C\u8BBE\u7F6E\u5F53\u524D\u7269\u7406\u673A\u5730\u5740,\u5982\u679C\u662Fdocker\u5B89\u88C5\u8282\u70B9\u7684IP\u5C06\u4F1A\u662F\u914D\u7F6E\u7684IP\u800C\u4E0D\u662Fdocker\u7F51\u7BA1ip</span>
<span class="token comment"># network.publish_host: 10.10.10.11</span>
<span class="token key atrule">http.port</span><span class="token punctuation">:</span> <span class="token number">9200</span>  <span class="token comment"># \u8BBE\u7F6E\u6620\u5C04\u7AEF\u53E3</span>
<span class="token key atrule">transport.port</span><span class="token punctuation">:</span> <span class="token number">9300</span>  <span class="token comment"># \u5185\u90E8\u8282\u70B9\u4E4B\u95F4\u6C9F\u901A\u7AEF\u53E3 </span>
<span class="token comment"># \u7EC4\u64AD\u5730\u5740</span>
<span class="token key atrule">discovery.seed_hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;10.10.10.12:9300&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;10.10.10.13:9300&quot;</span><span class="token punctuation">]</span>
<span class="token comment"># es7.x \u4E4B\u540E\u65B0\u589E\u7684\u914D\u7F6E\uFF0C\u5199\u5165\u5019\u9009\u4E3B\u8282\u70B9\u7684\u8BBE\u5907\u5730\u5740\uFF0C\u5728\u5F00\u542F\u670D\u52A1\u540E\u53EF\u4EE5\u88AB\u9009\u4E3A\u4E3B\u8282\u70B9</span>
<span class="token key atrule">cluster.initial_master_nodes</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;node-1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-2&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;node-3&quot;</span><span class="token punctuation">]</span>

</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><h3 id="\u96C6\u7FA4\u5B89\u5168" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u5B89\u5168" aria-hidden="true">#</a> \u96C6\u7FA4\u5B89\u5168</h3><p>\u2003\u2003Elasticsearch8.x\u7684\u7248\u672C\u4E2D\uFF0C\u5DF2\u7ECF\u5C06\u5B89\u5168\u7531\u53EF\u9009\u9879\u53D8\u6210\u4E86\u9ED8\u8BA4\u9009\u9879\u3002Elasticsearch\u7684\u5B89\u5168\u8BA4\u8BC1\u53EF\u4EE5\u53C2\u8003\u5B98\u7F51\u7684\u5B9E\u65BD\u65B9\u6848\uFF1Ahttps://www.elastic.co/guide/en/elasticsearch/reference/7.17/configuring-stack-security.html\uFF0C\u514D\u8D39\u7684\u65B9\u6848\u53EF\u4EE5\u91C7\u7528\u5982\u4E0B\uFF1A</p><ul><li>nginx\u53CD\u5411\u4EE3\u7406</li><li>\u514D\u8D39\u7684Security\u63D2\u4EF6\uFF1A <ul><li>Search Guard \uFF1A https://search-guard.com/</li><li>readonlyrest\uFF1A https://readonlyrest.com/</li></ul></li><li>X-Pack\u7684Basic\u7248</li></ul><p>\u2003\u2003\u53E6\u5916\uFF0CElasticsearch\u5185\u90E8\u662F\u901A\u8FC79300\u7AEF\u53E3\u8FDB\u884C\u4F20\u8F93\u7684\uFF0C\u5982\u679C\u4E0D\u5BF9\u6570\u636E\u52A0\u5BC6\uFF0C\u53EF\u80FD\u4F1A\u9020\u6210\u6570\u636E\u88AB\u6293\u5305\uFF0C\u654F\u611F\u4FE1\u606F\u6CC4\u6F0F\u7684\u7B49\u95EE\u9898\u3002\u9488\u5BF9\u6B64\u70B9\uFF0C\u53EF\u4EE5\u4F7F\u7528TLS\u534F\u8BAE\uFF08Trusted Certificate Authority (CA\uFF09\uFF09\u4E3A\u8282\u70B9\u521B\u5EFA\u8BC1\u4E66\uFF0C\u8BC1\u4E66\u8BA4\u8BC1\u6709\u4E09\u4E2A\u7EA7\u522B\uFF1A</p><ul><li>Certificate \u2014\u2014\u8282\u70B9\u52A0\u5165\u9700\u8981\u4F7F\u7528\u76F8\u540CCA\u7B7E\u53D1\u7684\u8BC1\u4E66</li><li>Full Verification\u2014\u2014\u8282\u70B9\u52A0\u5165\u96C6\u7FA4\u9700\u8981\u76F8\u540CCA\u7B7E\u53D1\u7684\u8BC1\u4E66\uFF0C\u8FD8\u9700\u8981\u9A8C\u8BC1Host name \u6216IP\u5730\u5740</li><li>No Verification\u2014\u2014\u4EFB\u4F55\u8282\u70B9\u90FD\u53EF\u4EE5\u52A0\u5165\uFF0C\u5F00\u53D1\u73AF\u5883\u4E2D\u7528\u4E8E\u8BCA\u65AD\u76EE\u7684</li></ul><h4 id="\u5185\u90E8\u901A\u4FE1tls\u8BC1\u4E66\u521B\u5EFA" tabindex="-1"><a class="header-anchor" href="#\u5185\u90E8\u901A\u4FE1tls\u8BC1\u4E66\u521B\u5EFA" aria-hidden="true">#</a> \u5185\u90E8\u901A\u4FE1TLS\u8BC1\u4E66\u521B\u5EFA</h4><ol><li>\u4E3A\u6BCF\u4E2A\u8282\u70B9\u521B\u5EFA\u8BC1\u4E66</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>bin/elasticsearch-certutil ca
<span class="token comment"># \u6267\u884C\u547D\u4EE4\u540E\u4F1A\u6709\u4E24\u6B21\u8F93\u5165\uFF0C\u7B2C\u4E00\u6B21\u4E3ACA\u6587\u4EF6\u540D\uFF0C\u7B2C\u4E8C\u6B21\u4E3A\u5BC6\u7801\uFF08\u5BC6\u78011\uFF09</span>
<span class="token comment"># \u5EFA\u8BAE\u4F9D\u6B21\u8F93\u5165\u56DE\u8F66\uFF08\u6587\u4EF6\u4F7F\u7528\u9ED8\u8BA4\u540D\uFF0C\u4E0D\u8BBE\u7F6E\u5BC6\u7801\uFF09</span>
<span class="token comment"># \u6267\u884C\u5B8C\u4F1A\u5728ES\u6839\u76EE\u5F55\u751F\u6210 elastic-stack-ca.p12 \u6587\u4EF6\uFF08\u9ED8\u8BA4\u6587\u4EF6\u540D\uFF09</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="2"><li>\u4E3A\u8282\u70B9\u9881\u53D1\u8BC1\u4E66</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>bin/elasticsearch-certutil cert --ca elastic-stack-ca.p12
<span class="token comment"># \u6267\u884C\u547D\u4EE4\u540E\u4F1A\u6709\u4E09\u6B21\u8F93\u5165</span>
<span class="token comment"># \u7B2C\u4E00\u6B21\u8F93\u5165\u4E3ACA\u5BC6\u7801\uFF08\u5BC6\u78011\uFF09</span>
<span class="token comment"># \u7B2C\u4E8C\u6B21\u8F93\u5165\u4E3A\u8BC1\u4E66\u6587\u4EF6\u540D\uFF0C\u5EFA\u8BAE\u76F4\u63A5\u56DE\u8F66\uFF08\u4F7F\u7528\u9ED8\u8BA4\u6587\u4EF6\u540D\uFF09</span>
<span class="token comment"># \u7B2C\u4E09\u6B21\u8F93\u5165\u4E3A\u8BC1\u4E66\u5BC6\u7801\uFF08\u5BC6\u78012\uFF09</span>
<span class="token comment"># \u6267\u884C\u5B8C\u4F1A\u5728ES\u76EE\u5F55\u751F\u6210 elastic-certificates.p12 \u6587\u4EF6\uFF08\u9ED8\u8BA4\u6587\u4EF6\u540D\uFF09</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ol start="3"><li>\u4F7F\u7528keystore\u4FDD\u5B58\u8BC1\u4E66\u5BC6\u7801</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>bin/elasticsearch-keystore <span class="token function">add</span> xpack.security.transport.ssl.keystore.secure_password 
bin/elasticsearch-keystore <span class="token function">add</span> xpack.security.transport.ssl.truststore.secure_password
<span class="token comment"># \u5982\u679C\u6CA1\u6709\u521B\u5EFA keystore \u6587\u4EF6\uFF0C\u4F1A\u63D0\u793A\u662F\u5426\u521B\u5EFA\uFF0C\u8F93\u5165y\u5373\u53EF\uFF08\u6587\u4EF6\u9ED8\u8BA4\u521B\u5EFA\u5728elasticsearch.yml \u540C\u7EA7\u76EE\u5F55\u4E0B\uFF09</span>
<span class="token comment"># \u7136\u540E\u8F93\u5165\u8BC1\u4E66\u5BC6\u7801\uFF08\u5BC6\u78012\uFF09</span>
<span class="token comment"># \u7ECF\u6D4B\u8BD5\u8BC1\u4E66\u5BC6\u7801\uFF08\u5BC6\u78012\uFF09\u4E3A\u7A7A\u7684\u65F6\u5019\uFF0C\u53EF\u4EE5\u7701\u7565\u8FD9\u4E00\u6B65</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ol start="4"><li>\u5C06\u751F\u6210\u7684 ca\u6587\u4EF6\u548C\u8BC1\u4E66\u6587\u4EF6\u79FB\u52A8\u5230config\u76EE\u5F55\uFF0C\u7136\u540E\u91CD\u542Fes\u670D\u52A1</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token function">mv</span> elastic-certificates.p12 config/
<span class="token function">mv</span> elastic-stack-ca.p12 config/
<span class="token comment"># \u547D\u4EE4\u793A\u4F8B\u4E3A\u9ED8\u8BA4\u6587\u4EF6\u540D</span>
<span class="token comment"># \u7ECF\u6D4B\u8BD5\uFF0Celastic-stack-ca.p12 \u6587\u4EF6\u53EF\u4EE5\u4E0D\u4FDD\u7559</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="5"><li>\u4E3A\u96C6\u7FA4\u4E2D\u5176\u4ED6\u8282\u70B9\u9881\u53D1\u8BC1\u4E66</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u6709\u4E24\u79CD\u65B9\u6CD5\uFF0C\u4EFB\u4E00\u90FD\u53EF\u4EE5</span>
<span class="token comment"># 1.\u8FDB\u5165\u96C6\u7FA4\u4E2D\u5176\u4ED6\u8282\u70B9 ES \u76EE\u5F55\uFF0C\u62F7\u8D1D\u6B65\u9AA42\u751F\u6210\u7684 CA \u6587\u4EF6\u5230 ES \u6839\u76EE\u5F55,\u7136\u540E\u91CD\u590D\u6B65\u9AA43\uFF0C4\uFF0C5</span>
<span class="token comment"># 2.\u767B\u5F55\u5176\u4ED6es\u5E94\u7528\u7528\u6237\uFF0C\u62F7\u8D1D\u6B65\u9AA43\u751F\u6210\u7684\u8BC1\u4E66\u6587\u4EF6\u548C keystore \u6587\u4EF6\uFF0C\u653E\u5230 ES config \u76EE\u5F55\uFF0C\u7136\u540E\u91CD\u542Fes\u670D\u52A1</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="6"><li>\u914D\u7F6E\u8282\u70B9\u95F4\u7684\u901A\u8BAF</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment">## elasticsearch.yml \u914D\u7F6E</span>
<span class="token key atrule">xpack.security.transport.ssl.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">xpack.security.transport.ssl.verification_mode</span><span class="token punctuation">:</span> certificate 
<span class="token key atrule">xpack.security.transport.ssl.client_authentication</span><span class="token punctuation">:</span> required
<span class="token key atrule">xpack.security.transport.ssl.keystore.path</span><span class="token punctuation">:</span> elastic<span class="token punctuation">-</span>certificates.p12
<span class="token key atrule">xpack.security.transport.ssl.truststore.path</span><span class="token punctuation">:</span> elastic<span class="token punctuation">-</span>certificates.p12
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="\u5F00\u542F\u5E76\u914D\u7F6Ex-pack\u7684\u8BA4\u8BC1" tabindex="-1"><a class="header-anchor" href="#\u5F00\u542F\u5E76\u914D\u7F6Ex-pack\u7684\u8BA4\u8BC1" aria-hidden="true">#</a> \u5F00\u542F\u5E76\u914D\u7F6EX-Pack\u7684\u8BA4\u8BC1</h4><ol><li>\u914D\u7F6E\u6587\u4EF6\u914D\u7F6E\u5F00\u542F\u8BA4\u8BC1(\u9ED8\u8BA4\u5F00\u542F)</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">xpack.security.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
<span class="token key atrule">xpack.security.enrollment.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ol start="2"><li>\u6DFB\u52A0http\u5BC6\u7801</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code>./bin/elasticsearch-keystore <span class="token function">add</span> xpack.security.http.ssl.keystore.secure_password

./bin/elasticsearch-keystore <span class="token function">add</span> xpack.security.http.ssl.truststore.secure_password
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="3"><li>\u914D\u7F6Ehttps\u8BA4\u8BC1</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">xpack.security.http.ssl.enabled</span><span class="token punctuation">:</span> <span class="token boolean important">false</span>
<span class="token key atrule">xpack.security.http.ssl.verification_mode</span><span class="token punctuation">:</span> certificate
<span class="token key atrule">xpack.security.http.ssl.truststore.path</span><span class="token punctuation">:</span> elastic<span class="token punctuation">-</span>certificates.p12
<span class="token key atrule">xpack.security.http.ssl.keystore.path</span><span class="token punctuation">:</span> elastic<span class="token punctuation">-</span>certificates.p12
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ol start="4"><li>\u96C6\u7FA4\u542F\u52A8\u540E\u4E3A\u5185\u7F6E\u8D26\u53F7\u6DFB\u52A0\u5BC6\u7801</li></ol><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u81EA\u52A8\u521B\u5EFA\u5BC6\u7801</span>
./bin/elasticsearch-setup-passwords auto
<span class="token comment"># \u624B\u52A8\u8F93\u5165\u5BC6\u7801</span>
./bin/elasticsearch-setup-passwords interactive
<span class="token comment"># \u968F\u673A\u91CD\u7F6E\u7528\u6237\u5BC6\u7801</span>
./bin/elasticsearch-reset-password -u elastic
<span class="token comment"># \u624B\u52A8\u91CD\u7F6E\u6307\u5B9A\u7528\u6237\u5BC6\u7801\uFF0C\u5185\u7F6E\u5E38\u7528\u7528\u6237apm_system, beats_system, elastic, kibana,logstash_system, remote_monitoring_user</span>
./bin/elasticsearch-reset-password -u elastic -i <span class="token operator">&lt;</span>password<span class="token operator">&gt;</span>

./bin/elasticsearch-reset-password -u apm_system -i Sq201240600255
./bin/elasticsearch-reset-password -u beats_system -i Sq201240600255
./bin/elasticsearch-reset-password -u elastic -i Sq201240600255
./bin/elasticsearch-reset-password -u kibana -i Sq201240600255
./bin/elasticsearch-reset-password -u logstash_system -i Sq201240600255
./bin/elasticsearch-reset-password -u remote_monitoring_user -i Sq201240600255
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><ol start="5"><li>\u914D\u7F6Ekibana</li></ol><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">elasticsearch.username</span><span class="token punctuation">:</span> <span class="token string">&quot;kibana&quot;</span>
<span class="token key atrule">elasticsearch.password</span><span class="token punctuation">:</span> <span class="token string">&quot;xxxxx&quot;</span>
<span class="token key atrule">elasticsearch.hosts</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">&quot;http://1.1.1.1:9200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://2.2.2.2:9200&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;http://3.3.3.3:9200&quot;</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ol start="6"><li>\u914D\u7F6Elogstash</li><li>\u914D\u7F6Ekafka</li></ol><h3 id="\u96C6\u7FA4\u542F\u52A8" tabindex="-1"><a class="header-anchor" href="#\u96C6\u7FA4\u542F\u52A8" aria-hidden="true">#</a> \u96C6\u7FA4\u542F\u52A8</h3><div class="language-bash ext-sh line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># \u8C03\u6574\u7CFB\u7EDF\u865A\u62DF\u5185\u5B58</span>
<span class="token function">vim</span> /etc/sysctl.conf
vm.max_map_count<span class="token operator">=</span><span class="token number">262144</span>
sysctl -p


<span class="token comment"># \u5F00\u542F\u5185\u5B58\u9501\u5B9A</span>
<span class="token function">vim</span> /etc/security/limits.conf
<span class="token comment"># -----\u6587\u4EF6\u5185\u5BB9-------</span>
* soft nofile <span class="token number">65536</span>

* hard nofile <span class="token number">65536</span>

* soft nproc <span class="token number">32000</span>

* hard nproc <span class="token number">32000</span>

* hard memlock unlimited

* soft memlock unlimited
<span class="token comment"># ------\u6587\u4EF6\u5185\u5BB9-------</span>


<span class="token function">vim</span> /etc/systemd/system.conf
<span class="token comment"># ------\u6587\u4EF6\u5185\u5BB9-------</span>
<span class="token assign-left variable">DefaultLimitNOFILE</span><span class="token operator">=</span><span class="token number">65536</span>
<span class="token assign-left variable">DefaultLimitNPROC</span><span class="token operator">=</span><span class="token number">32000</span>
<span class="token assign-left variable">DefaultLimitMEMLOCK</span><span class="token operator">=</span>infinity
<span class="token comment"># ------\u6587\u4EF6\u5185\u5BB9-------</span>

<span class="token comment">#\u975Eroot\u7528\u6237</span>
bin/elasticsearch 

<span class="token comment"># -d \u540E\u53F0\u542F\u52A8</span>
bin/elasticsearch -d
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br></div></div>`,61);function H(M,j){const n=c("RouterLink");return p(),r(i,null,[b,s("nav",m,[s("ul",null,[s("li",null,[a(n,{to:"#\u8282\u70B9\u89D2\u8272"},{default:e(()=>[d]),_:1})]),s("li",null,[a(n,{to:"#\u5355\u89D2\u8272\u90E8\u7F72"},{default:e(()=>[h]),_:1})]),s("li",null,[a(n,{to:"#\u6C34\u5E73\u6269\u5C55\u573A\u666F"},{default:e(()=>[k]),_:1})]),s("li",null,[a(n,{to:"#\u8BFB\u5199\u5206\u79BB\u573A\u666F"},{default:e(()=>[_]),_:1})]),s("li",null,[a(n,{to:"#\u5F02\u5730\u591A\u6D3B\u67B6\u6784"},{default:e(()=>[g]),_:1})]),s("li",null,[a(n,{to:"#hot-warm\u67B6\u6784"},{default:e(()=>[f]),_:1})]),s("li",null,[a(n,{to:"#\u96C6\u7FA4\u5BB9\u91CF\u89C4\u5212\u601D\u8DEF"},{default:e(()=>[y]),_:1}),s("ul",null,[s("li",null,[a(n,{to:"#\u4E1A\u52A1\u8BC4\u4F30\u548C\u5E94\u7528\u573A\u666F\u8BC4\u4F30"},{default:e(()=>[v]),_:1})]),s("li",null,[a(n,{to:"#\u786C\u4EF6\u548C\u5BB9\u91CF\u8BC4\u4F30"},{default:e(()=>[x]),_:1})]),s("li",null,[a(n,{to:"#\u90E8\u7F72\u65B9\u5F0F\u548C\u6269\u5BB9\u65B9\u5F0F\u8BC4\u4F30"},{default:e(()=>[w]),_:1})])])]),s("li",null,[a(n,{to:"#\u96C6\u7FA4\u89C4\u5212\u5178\u578B\u6848\u4F8B"},{default:e(()=>[E]),_:1}),s("ul",null,[s("li",null,[a(n,{to:"#\u5927\u6570\u636E\u96C6\u4F4E\u5199\u5165\u4E1A\u52A1\u89C4\u5212"},{default:e(()=>[q]),_:1})]),s("li",null,[a(n,{to:"#\u65F6\u95F4\u5E8F\u5217\u6570\u636E\u89C4\u5212"},{default:e(()=>[S]),_:1})])])]),s("li",null,[a(n,{to:"#\u9644\u5F55-\u7279\u6027\u3001\u90E8\u7F72\u3001\u914D\u7F6E"},{default:e(()=>[C]),_:1}),s("ul",null,[s("li",null,[a(n,{to:"#\u7248\u672C\u7279\u6027"},{default:e(()=>[A]),_:1})]),s("li",null,[a(n,{to:"#\u6587\u4EF6\u7ED3\u6784"},{default:e(()=>[L]),_:1})]),s("li",null,[a(n,{to:"#\u914D\u7F6E\u6587\u4EF6"},{default:e(()=>[V]),_:1})]),s("li",null,[a(n,{to:"#\u96C6\u7FA4\u5B89\u5168"},{default:e(()=>[N]),_:1})]),s("li",null,[a(n,{to:"#\u96C6\u7FA4\u542F\u52A8"},{default:e(()=>[O]),_:1})])])])])]),P],64)}var R=t(u,[["render",H]]);export{R as default};
