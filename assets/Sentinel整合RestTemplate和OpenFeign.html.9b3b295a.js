import{_ as t,r as l,o,a as c,d as n,b as a,w as e,F as i,e as u,f as p}from"./app.7eb989d9.js";var r="/docs/images/microservice/sentinel/\u6574\u5408RestTemplate.png";const k={},d=n("div",{class:"custom-container info"},[n("p",{class:"custom-container-title"},"\u76F8\u5173\u4FE1\u606F"),n("p",null,"\u2003\u2003Sentinel\u53EF\u4EE5\u6574\u5408RestTemplate\u3001OpenFeign\u548CDubbo\u8FD9\u4E9B\u5177\u6709\u8FDC\u7A0B\u8C03\u7528\u7684\u7EC4\u4EF6\u8FDB\u884C\u4F7F\u7528\uFF0C\u5E76\u4E14\u4E3A\u5176\u914D\u7F6E\u9650\u6D41\u89C4\u5219\u3002")],-1),b={class:"table-of-contents"},m=p("RestTemplate\u6574\u5408Sentinel"),h=p("\u6CE8\u5165RestTemplate"),f=p("\u914D\u7F6E\u6587\u4EF6"),g=p("\u8D44\u6E90\u89C4\u5219"),y=p("OpenFeign\u6574\u5408Sentinel"),v=p("\u5F00\u542F\u5BF9OpenFeign\u7684\u652F\u6301"),_=p("\u58F0\u660EOpenFeign\u63A5\u53E3"),F=p("\u5B9E\u73B0FallbackFactory"),w=p("\u5B9E\u73B0FallBack\u5B9E\u73B0\u7C7B"),R=u(`<hr><h2 id="resttemplate\u6574\u5408sentinel" tabindex="-1"><a class="header-anchor" href="#resttemplate\u6574\u5408sentinel" aria-hidden="true">#</a> RestTemplate\u6574\u5408Sentinel</h2><h3 id="\u6CE8\u5165resttemplate" tabindex="-1"><a class="header-anchor" href="#\u6CE8\u5165resttemplate" aria-hidden="true">#</a> \u6CE8\u5165RestTemplate</h3><p>\u2003\u2003\u6574\u5408RestTemplate\u9700\u8981\u4F7F\u7528@SentinelRestTemplate\u6CE8\u89E3\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">RestTemplateConfig</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Bean</span>
    <span class="token annotation punctuation">@LoadBalanced</span>
    <span class="token annotation punctuation">@SentinelRestTemplate</span><span class="token punctuation">(</span>
            blockHandler <span class="token operator">=</span> <span class="token string">&quot;handleException&quot;</span><span class="token punctuation">,</span>blockHandlerClass <span class="token operator">=</span> <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span>
            fallback <span class="token operator">=</span> <span class="token string">&quot;fallback&quot;</span><span class="token punctuation">,</span>fallbackClass <span class="token operator">=</span> <span class="token class-name">ExceptionUtil</span><span class="token punctuation">.</span><span class="token keyword">class</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">RestTemplate</span> <span class="token function">restTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">RestTemplate</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h3 id="\u914D\u7F6E\u6587\u4EF6" tabindex="-1"><a class="header-anchor" href="#\u914D\u7F6E\u6587\u4EF6" aria-hidden="true">#</a> \u914D\u7F6E\u6587\u4EF6</h3><p>\u2003\u2003\u9700\u8981\u5F00\u542FSentinel\u5BF9RestTemplate\u7684\u652F\u6301\uFF0C\u9ED8\u8BA4\u4E3Afalse\uFF1A</p><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">resttemplate</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="\u8D44\u6E90\u89C4\u5219" tabindex="-1"><a class="header-anchor" href="#\u8D44\u6E90\u89C4\u5219" aria-hidden="true">#</a> \u8D44\u6E90\u89C4\u5219</h3><p>\u2003\u2003Sentinel\u63D0\u4F9B\u4E86\u4E24\u79CD\u7C92\u5EA6\u7684\u8D44\u6E90\u89C4\u5219\u914D\u7F6E\uFF1A</p><ul><li>httpmetod:schema://host:port/path\uFF1A\u534F\u8BAE\u3001\u4E3B\u673A\u3001\u7AEF\u53E3\u3001\u8DEF\u5F84</li><li>httpmetod:schema://host:port\uFF1A\u534F\u8BAE\u3001\u4E3B\u673A\u3001\u7AEF\u53E3</li></ul><p><img src="`+r+`" alt="\u6574\u5408RestTemplate" loading="lazy"></p><h2 id="openfeign\u6574\u5408sentinel" tabindex="-1"><a class="header-anchor" href="#openfeign\u6574\u5408sentinel" aria-hidden="true">#</a> OpenFeign\u6574\u5408Sentinel</h2><p>\u2003\u2003Sentinel\u9002\u914D\u4E86OpenFeign\u7EC4\u4EF6\uFF0C\u5F15\u5165Spring Cloud Starter OpenFeign\u4F9D\u8D56\u5373\u53EF\u5B9E\u73B0\u81EA\u52A8\u914D\u7F6E\u3002</p><h3 id="\u5F00\u542F\u5BF9openfeign\u7684\u652F\u6301" tabindex="-1"><a class="header-anchor" href="#\u5F00\u542F\u5BF9openfeign\u7684\u652F\u6301" aria-hidden="true">#</a> \u5F00\u542F\u5BF9OpenFeign\u7684\u652F\u6301</h3><div class="language-yaml ext-yml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">feign</span><span class="token punctuation">:</span>
  <span class="token key atrule">sentinel</span><span class="token punctuation">:</span>
    <span class="token key atrule">enabled</span><span class="token punctuation">:</span> <span class="token boolean important">true</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="\u58F0\u660Eopenfeign\u63A5\u53E3" tabindex="-1"><a class="header-anchor" href="#\u58F0\u660Eopenfeign\u63A5\u53E3" aria-hidden="true">#</a> \u58F0\u660EOpenFeign\u63A5\u53E3</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@FeignClient</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;mall-order&quot;</span><span class="token punctuation">,</span>path <span class="token operator">=</span> <span class="token string">&quot;/order&quot;</span><span class="token punctuation">,</span>fallbackFactory <span class="token operator">=</span> <span class="token class-name">FallbackOrderFeignServiceFactory</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">OrderFeignService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;/order/{id}&quot;</span><span class="token punctuation">)</span>
    <span class="token class-name">BaseResponse</span> <span class="token function">getOrderById</span><span class="token punctuation">(</span><span class="token annotation punctuation">@PathVariable</span><span class="token punctuation">(</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">)</span> <span class="token class-name">Integer</span> id<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h3 id="\u5B9E\u73B0fallbackfactory" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0fallbackfactory" aria-hidden="true">#</a> \u5B9E\u73B0FallbackFactory</h3><p>\u2003\u2003\u5B9E\u73B0FallbackFactory\u6216\u8005\u5B9E\u73B0FallBack\u4E8C\u9009\u4E00\u5373\u53EF\uFF0C\u5177\u4F53\u6839\u636EFeignClient\u4E2D\u7684\u914D\u7F6E\u51B3\u5B9A\uFF0C\u901A\u8FC7FallBackFactory\u53EF\u4EE5\u62FF\u5230\u5F02\u5E38\uFF0C\u901A\u8FC7\u4E0D\u540C\u7684\u5F02\u5E38\u8FDB\u884C\u9488\u5BF9\u6027\u7684\u5904\u7406\uFF0C\u76F4\u63A5\u914D\u7F6EFallback\u7684\u8BDD\u65E0\u6CD5\u83B7\u53D6\u5230\u5F02\u5E38\uFF1A</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FallbackOrderFeignServiceFactory</span> <span class="token keyword">implements</span> <span class="token class-name">FallbackFactory</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">OrderFeignService</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">OrderFeignService</span> <span class="token function">create</span><span class="token punctuation">(</span><span class="token class-name">Throwable</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">OrderFeignService</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">BaseResponse</span> <span class="token function">getOrderById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">BaseResponse</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">FlowException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    result <span class="token operator">=</span> <span class="token class-name">BaseResponse</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span>FLOW_RESTRICTION<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">DegradeException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    result <span class="token operator">=</span> <span class="token class-name">BaseResponse</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span>RELEGATION<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">ParamFlowException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    result <span class="token operator">=</span> <span class="token class-name">BaseResponse</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span>HOTSPOT_RESTRICTION<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">SystemBlockException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    result <span class="token operator">=</span> <span class="token class-name">BaseResponse</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span>SYSTEM_BLOCKED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>e <span class="token keyword">instanceof</span> <span class="token class-name">AuthorityException</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    result <span class="token operator">=</span> <span class="token class-name">BaseResponse</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span>FLOW_UNAUTHORIZED<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="\u5B9E\u73B0fallback\u5B9E\u73B0\u7C7B" tabindex="-1"><a class="header-anchor" href="#\u5B9E\u73B0fallback\u5B9E\u73B0\u7C7B" aria-hidden="true">#</a> \u5B9E\u73B0FallBack\u5B9E\u73B0\u7C7B</h3><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token annotation punctuation">@Component</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">FallBackeOrderFeignService</span> <span class="token keyword">implements</span> <span class="token class-name">OrderFeignService</span><span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">BaseResponse</span> <span class="token function">getOrderById</span><span class="token punctuation">(</span><span class="token class-name">Integer</span> id<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token class-name">BaseResponse</span><span class="token punctuation">.</span><span class="token function">failed</span><span class="token punctuation">(</span><span class="token string">&quot;\u670D\u52A1\u88AB\u964D\u7EA7&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div>`,23);function O(x,S){const s=l("RouterLink");return o(),c(i,null,[d,n("nav",b,[n("ul",null,[n("li",null,[a(s,{to:"#resttemplate\u6574\u5408sentinel"},{default:e(()=>[m]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#\u6CE8\u5165resttemplate"},{default:e(()=>[h]),_:1})]),n("li",null,[a(s,{to:"#\u914D\u7F6E\u6587\u4EF6"},{default:e(()=>[f]),_:1})]),n("li",null,[a(s,{to:"#\u8D44\u6E90\u89C4\u5219"},{default:e(()=>[g]),_:1})])])]),n("li",null,[a(s,{to:"#openfeign\u6574\u5408sentinel"},{default:e(()=>[y]),_:1}),n("ul",null,[n("li",null,[a(s,{to:"#\u5F00\u542F\u5BF9openfeign\u7684\u652F\u6301"},{default:e(()=>[v]),_:1})]),n("li",null,[a(s,{to:"#\u58F0\u660Eopenfeign\u63A5\u53E3"},{default:e(()=>[_]),_:1})]),n("li",null,[a(s,{to:"#\u5B9E\u73B0fallbackfactory"},{default:e(()=>[F]),_:1})]),n("li",null,[a(s,{to:"#\u5B9E\u73B0fallback\u5B9E\u73B0\u7C7B"},{default:e(()=>[w]),_:1})])])])])]),R],64)}var B=t(k,[["render",O]]);export{B as default};
