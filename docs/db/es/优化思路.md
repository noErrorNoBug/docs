# 客户端优化

## 批量提交数据

对于大量的读写请求，一般推荐_bulk进行写入，通常批量提交的数据不大于100M，单次批处理的数量最好控制在5-15M左右，然后逐步递增。

## 路由选择

```sql
shard = hash(routing) % number_of_primary_shards 
```
分片是通过以上的公式计算出来的，routing的默认值是doc的id，在存入数据和查询数据时，如果可以轻松识别routing的，可以指定routing直接定位分片，极大的提高效率。
# 服务端优化

## 分片策略

* 合理设置分片数，分片数的多少决定着请求命中时同一个节点的的资源竞争和相关度的计算，因为相关度是基于分片计算的，太多的分片会导致数据的相关度都非常低。
* 推迟分片分配：delay_timeout可以设置节点中断后再分配分片的延时，在这个延时内连接上的则不会重新分配分片。
## 减少Refresh次数

对于es采用了延迟写的策略，先将索引写入内存中，然后延时一段时间再写入磁盘。默认情况下refresh的时间是1s，如果对数据的实时性要求不高，可以将这个时间设置的稍微长一些。但是同时会消耗更多的堆内存，用空间换时间。

## 加大Flush设置

Flush的目的是将文件缓存系统中的数据持久化到磁盘，当translog的数据达到512M或者30min时会触发一次Flush。可以设置更大的文件缓存系统的量，如1G等再Flush到内存中。同样的也需要准备大量的文件系统缓存，用空间换时间。

## 减少副本的数量

副本节点数量越多，越影响写入速度（同步副本数量越多），一定要有限度的控制副本数量。

# 操作系统优化

## 优化磁盘

使用高质量磁盘，有能力的话上SSD。




